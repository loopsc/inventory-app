<html>

<head>
    <title>
        <%= title %>
    </title>
    <link rel="stylesheet" href="/styles.css">
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            document.querySelectorAll(".btn.del").forEach(btn => {
                btn.addEventListener("click", async () => {
                    const book = JSON.parse(btn.dataset.book);
                    const password = prompt("Enter password to delete");

                    const res = await fetch(`/books/${book.id}`, {
                        method: "DELETE",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ password, book })
                    });

                    if (res.ok) {
                        btn.closest(".book-container").remove();
                    } else {
                        alert("Failed to delete or wrong password");
                    }
                });
            });
        })

    </script>
</head>

<body>
    <main class="content">
        <%- include('./partials/navbar') %>

            <div class="books">
                <% books.forEach(book=> { %>
                    <div class="book-container">
                        <div class="book-header">
                            <p class="book-title">
                                <%= book.title %>
                            </p>
                            <p class="book-author">
                                <%= book.author %>
                            </p>
                        </div>
                        <div class="book-details">
                            <% const genresArr=Array.isArray(book.genres) ? book.genres : [book.genres] %>
                                <% genresArr.forEach((genre)=> { %>
                                    <p>
                                        <%= genre %>
                                    </p>
                                    <% }) %>
                                        <p>Fiction: <%= book.is_fiction ? 'True' : 'False' %>
                                        </p>
                                        <p>Read: <%= book.is_read ? 'True' : 'False' %>
                                        </p>
                        </div>
                        <div class="btn-group">
                            <a href="/update/<%= book.id %>" class="btn-edit">
                                <button class="btn edit">Edit</button>
                            </a>
                            <button class="btn del" data-book='<%= JSON.stringify(book) %>'>Delete</button>
                        </div>
                    </div>
                    <% }); %>

            </div>
    </main>
</body>

</html>